<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mi Malla</title>
  <link rel="stylesheet" href="../css/inicio2.css">
</head>

<body>
  <nav>
    <ul>
      <li><a href="../html2/malla.html" class="active">Mi Malla</a></li>
      <li><a href="../html2/resumen.html">Resumen</a></li>
      <li><a href="../html2/comparacion.html">Comparación</a></li>
      <li><a href="../html2/versiones.html">Versiones</a></li>
      <li><a href="../html2/perfil.html">Perfil</a></li>
      <li><a href="../html2/index.html" class="logout">Salir</a></li>
    </ul>
  </nav>

  <main>
    <h2>Bienvenido, <span id="usuarioNombre"></span></h2>
    <p>RUT: <span id="usuarioRut"></span></p>
  </main>

  <footer>
    <p>© 2025 Universidad del Norte</p>
  </footer>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const rut = localStorage.getItem("rut");
  const carreras = JSON.parse(localStorage.getItem("carreras") || "[]");

  const mensaje = document.createElement("div");
  mensaje.style.marginTop = "15px";
  document.querySelector("main").appendChild(mensaje);

  if (!rut || carreras.length === 0) {
    alert("Por favor, inicia sesión nuevamente.");
    window.location.href = "index.html";
    return;
  }

  const user = localStorage.getItem("usuario");
  document.getElementById("usuarioNombre").textContent = user;
  document.getElementById("usuarioRut").textContent = rut;
  const carrera = carreras[0];
  mensaje.innerHTML = `<p><strong>Cargando malla de ${carrera.nombre} (${carrera.codigo})...</strong></p>`;

  try {
    const response = await fetch(`http://localhost:3000/malla`, {
      method: "GET"
    });

    if (!response.ok) throw new Error(`Error HTTP ${response.status}`);

    const data = await response.json();
    console.log("Datos de malla:", data);

    if (!Array.isArray(data) || data.length === 0) {
      mensaje.innerHTML = "<p>No se encontró información de malla para esta carrera.</p>";
      return;
    }

    const table = document.createElement("table");
    table.innerHTML = `
      <thead>
        <tr>
          <th>Código</th>
          <th>Asignatura</th>
          <th>Créditos</th>
          <th>Nivel</th>
          <th>Prerrequisitos</th>
        </tr>
      </thead>
      <tbody>
        ${data.map(curso => `
          <tr>
            <td>${curso.codigo}</td>
            <td>${curso.asignatura}</td>
            <td>${curso.creditos}</td>
            <td>${curso.nivel}</td>
            <td>${curso.prereq || "—"}</td>
          </tr>
        `).join("")}
      </tbody>
    `;
    table.style.width = "100%";
    table.style.borderCollapse = "collapse";
    table.style.marginTop = "15px";
    table.querySelectorAll("th, td").forEach(el => {
      el.style.border = "1px solid #ddd";
      el.style.padding = "8px";
    });

    mensaje.innerHTML = `<h3>Malla de ${carrera.nombre}</h3>`;
    mensaje.appendChild(table);

  } catch (error) {
    console.error("Error al obtener malla:", error);
    mensaje.innerHTML = `<p style="color:orange;">Error al conectar con la API de malla.</p>`;
  }
});
</script>

  <script src="../js2/main.js"></script>
</body>
</html>

